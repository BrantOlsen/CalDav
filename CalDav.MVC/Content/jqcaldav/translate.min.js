function loadLanguage(e,t){if((new RegExp("[./]")).test(e))return;$.ajax({url:jqcaldavPath+String(e).toLowerCase()+".js",async:!1,dataType:"json",success:function(n){if(n.ui!=undefined){languages[e]=n,typeof t=="function"&&t(e);return}/.-./.test(e)?$.ajax({url:jqcaldavPath+String(e).replace(/-.*/,"").toLowerCase()+".js",async:!1,dataType:"json",success:function(n){if(n.ui!=undefined){languages[e]=n,typeof t=="function"&&t(e);return}typeof t=="function"&&t(!1)},error:function(){alert("not found")}}):typeof t=="function"&&t(!1)},error:function(){/.-./.test(e)?$.ajax({url:jqcaldavPath+String(e).replace(/-.*/,"").toLowerCase()+".js",async:!1,dataType:"json",success:function(n){if(n.ui!=undefined){languages[e]=n,typeof t=="function"&&t(e);return}typeof t=="function"&&t(!1)},error:function(){alert("not found")}}):(alert("not found"),typeof t=="function"&&t(!1))}})}function showTranslation(e){if(e==0){alert("translation file corrupt, missing or otherwise broken");return}var t=$('<div id="translator" class="calpopup" data-lang="'+e+'"></div>'),n=$("<ul></ul>"),r=$("<li>"+i+"</li>");$(n).append('<li><span<span class="value">Translation</span></li>');for(var i in defaults){var r=$("<li>"+i+"</li>"),s=$('<ul section="'+i+'"></ul>');for(var o in defaults[i])if(typeof defaults[i][o]!="string"){var u=$('<li entry="'+o+'"></li>'),a=$('<ul section="'+o+'"></ul>');for(var f in defaults[i][o]){if(languages[e]!=undefined&&languages[e][i]!=undefined&&languages[e][i][o]!=undefined&&languages[e][i][o][f])var l=$('<li entry="'+f+'"><span class="label">'+f+'</span><span class="default value">'+defaults[i][o][f]+'</span><span class="value '+e+'" contenteditable="true" >'+languages[e][i][o][f]+"</span></li>");else var l=$('<li entry="'+f+'"><span class="label">'+f+'</span><span class="default value">'+defaults[i][o][f]+'</span><span class="value '+e+' missing" contenteditable="true" >'+defaults[i][o][f]+"</span></li>");$(a).append(l)}$(u).append(a),$(s).append(u)}else{if(languages[e]!=undefined&&languages[e][i]!=undefined&&languages[e][i][o])var u=$('<li entry="'+o+'"><span class="label">'+o+'</span><span class="default value">'+defaults[i][o]+'</span><span class="value '+e+'" contenteditable="true" >'+languages[e][i][o]+"</span></li>");else var u=$('<li entry="'+o+'"><span class="label">'+o+'</span><span class="default value">'+defaults[i][o]+'</span><span class="value '+e+' missing" contenteditable="true" >'+defaults[i][o]+"</span></li>");$(s).append(u)}$(r).append(s),$(n).append(r)}$(n).css({"max-height":"90%",overflow:"scroll"}),$(t).append(n),$(t).append('<div class="button delete">translate!</div>'),$(t).append('<div class="button done">close</div>'),$(".delete",t).click(saveTranslation),$(".done",t).click(function(){$("#translator").remove()}),$(t).css({top:50,left:window.innerWidth*.2,"min-height":200,"min-width":400,height:window.innerHeight-100,width:window.innerWidth*.6,position:"absolute","z-index":150}),$("#translator").remove(),draggable(t),$("#calwrap").append(t)}function saveTranslation(){var e={},t=$("#translator").data("lang");if(t==undefined||t.length<2){alert("bad language name");return}for(var n in defaults){e[n]={};for(var r in defaults[n])if(typeof defaults[n][r]!="string"){e[n][r]={};for(var i in defaults[n][r])e[n][r][i]=$('#translator ul[section="'+n+'"] li[entry="'+r+'"] li[entry="'+i+'"] .value.'+t+":first").text()}else e[n][r]=$('#translator ul[section="'+n+'"] li[entry="'+r+'"] .value.'+t+":first").text()}languages[t]=e,$("#translator ul").replaceWith('<div id="translatedText">'+JSON.stringify(e)+"</div>"),$("#translatedText").css({"max-height":"50%",overflow:"scroll"}),$("#translator").append('<div class="button save" style="width: 40%; float: left;" title="should work with calendarserver">Save to Server</div>'),$("#translator").append('<div class="button email" style="width: 40%; float: left; " title="should work with calendarserver"><a href="mailto:rob+jqcaldav@boxacle.net?subject=jqcaldav translation for '+t+"&body="+encodeURIComponent(JSON.stringify(e))+'" >Email translation</a></div>'),$("#translator .save").click(function(e){var n=$("#translatedText").text();$.put({url:jqcaldavPath+t+".js",username:$.fn.caldav.options.username,password:$.fn.caldav.options.password,data:n,complete:function(e,t){if(t!="success"){$("#translatedText").css({outline:"2px solid red"}),$("#translatedText").attr("contenteditable","true");var n=document.createRange();n.selectNodeContents($("#translatedText")[0]);var r=window.getSelection();return r.removeAllRanges(),r.addRange(n),alert("failed, please email the contents of the red highlighted box instead"),e.abort(),!1}$("#translator .save").remove(),$("#translatedText").text("Saved! Please commit and send or push the changes, thanks for your help.")}})})}function translate(e){loadLanguage(e,showTranslation)}function startTranslating(){var e=$('<div id="starttranslator" class="calpopup" ></div>');$(e).append('<div><span class="label">Language</span><span class="value" contenteditable="true">'+String(navigator.language?navigator.language:navigator.userLanguage).toLowerCase()+"</span></div>"),$(e).append('<div class="button delete">translate!</div>'),$(e).append('<div class="button done">close</div>'),$(".delete",e).click(function(e){var t=$("#starttranslator .value").text();t!=""&&t.length>1?(translate(t),$("#starttranslator").remove()):"#starttranslator .value".css("outline","1px solid red")}),$(".done",e).click(function(){$("#starttranslator").remove()}),$(e).css({top:window.innerHeight*.4,left:window.innerWidth*.3,"min-height":200,"min-width":400,height:window.innerHeight*.2,width:window.innerWidth*.4,position:"absolute","z-index":150}),draggable(e),$("#calwrap").append(e),$("#starttranslator .value").focus()}var languages={}