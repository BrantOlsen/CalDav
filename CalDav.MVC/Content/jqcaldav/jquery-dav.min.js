function wwajax(e){var t=new Worker("worker.js");t.onmessage=function(e){switch(e.status){case-1:t.errorHandler&&t.errorHandler(e);break;case"progress":break;default:t.successHandler&&t.successHandler(e)}},e.successHandler&&typeof e.successHandler=="function"&&(t.successHandler=e.successHandler);var n={};for(var r in e)typeof e[r]!="function"&&(n[r]=e[r]);return n.cmd="config",t.postMessage(n),t}jQuery.fn.filterNsNode=function(e){return this.filter(function(){return this.nodeName===e||this.nodeName.replace(RegExp("^[^:]+:",""),"")===e})},jQuery.extend({httpoverride:function(e,t){return function(n,r){if(n.status==200){var i=e.type;if(e.beforeSend!=undefined){var s=e.beforeSend;e.beforeSend=function(e){s(),e.setRequestHeader("X-Http-Method-Override",i)}}else e.beforeSend=function(e){e.setRequestHeader("X-Http-Method-Override",i)};e.type="POST",jQuery.ajax(e)}else typeof t=="function"&&t(n,r)}},options:function(e){$.ajaxSetup.headers={};var t=jQuery.extend(!0,{},jQuery.ajaxSettings,{type:"OPTIONS"},e);return jQuery.ajax({beforeSend:function(e){var n=t.headers;for(var r in n)e.setRequestHeader(r,n[r])},cache:t.cache,data:t.data,password:encodeURIComponent(t.password),username:encodeURIComponent(t.username),type:"OPTIONS",url:t.url,success:t.success,complete:t.complete})},POST:function(e){$.ajaxSetup.headers={};var t=jQuery.extend(!0,{},jQuery.ajaxSettings,{type:"POST"},e);return jQuery.ajax({beforeSend:function(e){var n=t.headers;for(var r in n)e.setRequestHeader(r,n[r])},cache:t.cache,data:t.data,contentType:t.contentType,password:encodeURIComponent(t.password),username:encodeURIComponent(t.username),type:"POST",url:t.url,success:t.success,complete:t.complete})},head:function(e){$.ajaxSetup.headers={};var t=jQuery.extend(!0,{},jQuery.ajaxSettings,{type:"OPTIONS"},e);return jQuery.ajax({beforeSend:function(e){var n=t.headers;for(var r in n)e.setRequestHeader(r,n[r])},cache:t.cache,data:t.data,password:encodeURIComponent(t.password),username:encodeURIComponent(t.username),type:"HEAD",url:t.url,success:t.success,complete:t.complete})},propfind:function(e){$.ajaxSetup.headers={};var t=jQuery.extend(!0,{},jQuery.ajaxSettings,{contentType:"text/xml",type:"PROPFIND"},e),n={beforeSend:function(e){var n=t.headers;for(var r in n)e.setRequestHeader(r,n[r])},cache:t.cache,contentType:t.contentType,data:t.data,password:encodeURIComponent(t.password),username:encodeURIComponent(t.username),type:"PROPFIND",url:t.url,complete:t.complete,withCredentials:!0};return n.success=jQuery.httpoverride(n,t.success),jQuery.ajax(n)},proppatch:function(e){$.ajaxSetup.headers={};var t=jQuery.extend(!0,{},jQuery.ajaxSettings,{contentType:"text/xml",type:"PROPPATCH"},e);return jQuery.ajax({beforeSend:function(e){var n=t.headers;for(var r in n)e.setRequestHeader(r,n[r])},cache:t.cache,contentType:t.contentType,data:t.data,password:encodeURIComponent(t.password),username:encodeURIComponent(t.username),type:"PROPPATCH",url:t.url,success:t.success,complete:t.complete})},acl:function(e){$.ajaxSetup.headers={};var t=jQuery.extend(!0,{},jQuery.ajaxSettings,{contentType:"text/xml",type:"ACL"},e);return jQuery.ajax({beforeSend:function(e){var n=t.headers;for(var r in n)e.setRequestHeader(r,n[r])},cache:t.cache,contentType:t.contentType,data:t.data,password:encodeURIComponent(t.password),username:encodeURIComponent(t.username),type:"ACL",url:t.url,success:t.success,complete:t.complete})},report:function(e){$.ajaxSetup.headers={};var t=jQuery.extend(!0,{},jQuery.ajaxSettings,{contentType:"text/xml",type:"REPORT"},e);return jQuery.ajax({beforeSend:function(e){var n=t.headers;for(var r in n)e.setRequestHeader(r,n[r])},cache:t.cache,contentType:t.contentType,data:t.data,password:encodeURIComponent(t.password),username:encodeURIComponent(t.username),type:"REPORT",url:t.url,success:t.success,complete:t.complete})},mkcol:function(e){$.ajaxSetup.headers={};var t=jQuery.extend(!0,{},jQuery.ajaxSettings,{contentType:"text/xml",type:"MKCOL"},e);return jQuery.ajax({beforeSend:function(e){var n=t.headers;for(var r in n)e.setRequestHeader(r,n[r])},cache:t.cache,contentType:t.contentType,data:t.data,password:encodeURIComponent(t.password),username:encodeURIComponent(t.username),type:"MKCOL",url:t.url,success:t.success,complete:t.complete})},mkcalendar:function(e){$.ajaxSetup.headers={};var t=jQuery.extend(!0,{},jQuery.ajaxSettings,{contentType:"text/xml",type:"MKCALENDAR"},e);return jQuery.ajax({beforeSend:function(e){var n=t.headers;for(var r in n)e.setRequestHeader(r,n[r])},cache:t.cache,contentType:t.contentType,data:t.data,password:encodeURIComponent(t.password),username:encodeURIComponent(t.username),type:"MKCALENDAR",url:t.url,success:t.success,complete:t.complete})},move:function(e){$.ajaxSetup.headers={};var t=jQuery.extend(!0,{},jQuery.ajaxSettings,e,{type:"MOVE"});return jQuery.ajax({beforeSend:function(e){var n=t.headers;for(var r in n)e.setRequestHeader(r,n[r])},contentType:t.contentType,password:encodeURIComponent(t.password),username:encodeURIComponent(t.username),type:"MOVE",url:t.url,success:t.success,complete:t.complete})},del:function(e){$.ajaxSetup.headers={};var t=jQuery.extend(!0,{},jQuery.ajaxSettings,e,{type:"DELETE"});return jQuery.ajax({beforeSend:function(e){var n=t.headers;for(var r in n)e.setRequestHeader(r,n[r])},contentType:t.contentType,password:encodeURIComponent(t.password),username:encodeURIComponent(t.username),type:"DELETE",url:t.url,success:t.success,complete:t.complete})},put:function(e){$.ajaxSetup.headers={};var t=jQuery.extend(!0,{},jQuery.ajaxSettings,{type:"PUT"},e);return jQuery.ajax({beforeSend:function(e){var n=t.headers;for(var r in n)e.setRequestHeader(r,n[r])},cache:t.cache,contentType:t.contentType,data:t.data,password:encodeURIComponent(t.password),username:encodeURIComponent(t.username),type:"PUT",url:t.url,success:t.success,complete:t.complete})},lock:function(e){$.ajaxSetup.headers={};var t=jQuery.extend(!0,{},jQuery.ajaxSettings,{contentType:"text/xml",type:"LOCK"},e);return jQuery.ajax({beforeSend:function(e){var n=t.headers;for(var r in n)e.setRequestHeader(r,n[r])},cache:t.cache,contentType:t.contentType,data:t.data,password:encodeURIComponent(t.password),username:encodeURIComponent(t.username),type:"LOCK",url:t.url,success:t.success,complete:t.complete})},unlock:function(e){$.ajaxSetup.headers={};var t=jQuery.extend(!0,{},jQuery.ajaxSettings,{contentType:"text/xml",type:"UNLOCK"},e);return jQuery.ajax({beforeSend:function(e){var n=t.headers;for(var r in n)e.setRequestHeader(r,n[r])},cache:t.cache,contentType:t.contentType,data:t.data,password:encodeURIComponent(t.password),username:encodeURIComponent(t.username),type:"UNLOCK",url:t.url,success:t.success,complete:t.complete})},bind:function(e){$.ajaxSetup.headers={};var t=jQuery.extend(!0,{},jQuery.ajaxSettings,{contentType:"text/xml",type:"BIND"},e);return jQuery.ajax({beforeSend:function(e){var n=t.headers;for(var r in n)e.setRequestHeader(r,n[r])},cache:t.cache,contentType:t.contentType,data:t.data,password:encodeURIComponent(t.password),username:encodeURIComponent(t.username),type:"BIND",url:t.url,success:t.success,complete:t.complete})},unbind:function(e){$.ajaxSetup.headers={};var t=jQuery.extend(!0,{},jQuery.ajaxSettings,{contentType:"text/xml",type:"UNBIND"},e);return jQuery.ajax({beforeSend:function(e){var n=t.headers;for(var r in n)e.setRequestHeader(r,n[r])},cache:t.cache,contentType:t.contentType,data:t.data,password:encodeURIComponent(t.password),username:encodeURIComponent(t.username),type:"UNBIND",url:t.url,success:t.success,complete:t.complete})}}),function(e){var t={init:function(t){this.options=t,e.fn.caldav.options=t,e.fn.caldav.events||(e.fn.caldav.entries=new Object),e.fn.caldav.eventTiming=new Array,e.fn.caldav.eventAverageTime=100,e.fn.caldav.coalesceEvents=new Array,e.fn.caldav.principals=new Array,e.fn.caldav.principalMap=new Object,e.fn.caldav.inboxMap=new Object,e.fn.caldav.outboxMap=new Object,e.fn.caldav.calendarData=new Array,e.fn.caldav.collectionData=new Array,e.fn.caldav.locks={},e.fn.caldav.supports={},e.fn.caldav.reports={},e.fn.caldav.syncable=!1,e.fn.caldav.xmlNSfield="localName",document.documentElement.baseName&&(e.fn.caldav.xmlNSfield="baseName");if(e(this.options.loading).length<1){var n=e('<div id="caldavloading" style="display:none;position:fixed;left:100%;top:100%;margin-top:-1em;margin-left:-4em;text-align: center; width:4em; background-color:blue;color:white;-moz-border-top-left-radius:.5em;-webkit-border-top-left-radius:.5em;border-top-left-radius:.5em;opacity:.5;z-index:100;" data-loading="0" >loading</div>');e(document.body).append(n),this.options.loading=e("#caldavloading")}return e(this.options.loading).data("loading",0),this},getCalendars:function(){e.fn.caldav("findMyPrincipal",function(){var t=function(){var t=e.fn.caldav.principals,n=[];for(var r=0;r<t.length;r++)t[r].calendar!=""&&n.indexOf(t[r].calendar)==-1&&n.push(t[r].calendar);e.fn.caldav.starting=n.length,debug&&n.length==0&&alert("no calendars found");for(var r=0;r<n.length;r++){if(String(n[r]).length<3){e.fn.caldav.starting--;if(e.fn.caldav.starting==0){e.fn.caldav("sortCalendarData");for(var i in e.fn.caldav.collectionData)for(var s in e.fn.caldav.collectionData[i].supportedReports)e.fn.caldav.reports[s]=!0;e.fn.caldav.options.calendars&&e.fn.caldav.options.calendars(e.fn.caldav.calendarData)}continue}e.fn.caldav("getCalendarData",{url:n[r]},function(){e.fn.caldav.starting--;if(e.fn.caldav.starting==0){e.fn.caldav("sortCalendarData");for(var t in e.fn.caldav.collectionData)for(var n in e.fn.caldav.collectionData[t].supportedReports)e.fn.caldav.reports[n]=!0;e.fn.caldav.options.calendars&&e.fn.caldav.options.calendars(e.fn.caldav.calendarData)}})}};e.fn.caldav.options.fullDiscovery?e.fn.caldav("findDelagatedPrincipals","",t):t()})},sortCalendarData:function(){e.fn.caldav.calendarData.sort(function(t,n){var r=0;return t.principal!=e.fn.caldav.data.myPrincipal?r=1:t.principal==e.fn.caldav.data.myPrincipal&&(r=-1),r})},getCalendarData:function(t,n){e.fn.caldav("spinner",!0);var r={Depth:1},i="";return e.fn.caldav.supports.bind&&(r.DAV="bind",i="<x0:resource-id/><x0:parent-set/>\n"),e.propfind(e.extend(!0,{},jQuery.fn.caldav.options,t,{headers:r,data:'<?xml version="1.0" encoding="utf-8"?>\n<x0:propfind xmlns:x1="http://calendarserver.org/ns/" xmlns:x0="DAV:" xmlns:x3="http://apple.com/ns/ical/" xmlns:x2="urn:ietf:params:xml:ns:caldav" xmlns:x4="http://boxacle.net/ns/calendar/">\n<x0:prop>\n<x0:displayname/>\n<x2:calendar-description/>\n<x2:calendar-user-address-set/>\n<x2:calendar-inbox-URL/>\n<x2:calendar-outbox-URL/>\n<x3:calendar-color/>\n<x3:calendar-order/>\n<x4:calendar-settings/>\n<x4:calendar-subscriptions/>\n<x0:resourcetype/>\n<x0:acl/>\n<x0:owner/>\n<x0:supported-privilege-set/>\n<x0:supported-report-set/>\n<x0:current-user-privilege-set/>\n'+i+"</x0:prop>"+"\n"+"</x0:propfind>",complete:function(r,i){return e.fn.caldav("spinner",!1),i=="success"?e(this).caldav("parseCalendars",r):debug&&console.log("error getting calendar data for "+t.url),typeof n=="function"&&n(r,i),!1}})),this},parseCalendars:function(t,n){var r=e("*|resourcetype > *|collection",t.responseXML).closest("*|response"),i=e("*|resourcetype > *|calendar",t.responseXML).closest("*|response"),s=e("*|resourcetype >    *|schedule-inbox",t.responseXML).closest("*|response"),o=e("*|resourcetype >   *|schedule-outbox",t.responseXML).closest("*|response"),u=jQuery.fn.caldav.options.url.replace(/(\/\/[.a-zA-Z0-9-])\/.*$/,"$1"),a=0,f=!1,l=!1,c=new Array;debug&&console.log("found "+r.length+" collections "+i.length+" calendars "+s.length+" inboxes "+o.length+" outboxes ",t.responseXML),e.fn.caldav.collectionData&&e.fn.caldav.collectionData.length>0&&(a=e.fn.caldav.collectionData.length);for(var h=0;h<s.length;h++){var p=e.trim(e("*|owner > *|href",s[h]).text()),d=e("> *|href",s[h]).text();e.fn.caldav.inboxMap[p]=decodeURIComponent(d)}for(var h=0;h<o.length;h++){var p=e.trim(e("*|owner > *|href",o[h]).text()),d=e("> *|href",o[h]).text();e.fn.caldav.outboxMap[p]=decodeURIComponent(d)}for(var h=0;h<r.length;h++){var d=decodeURIComponent(e("> *|href",r[h]).text());debug&&console.log("processing principal "+d);if(e("*|resourcetype > *|webdav-binding",r[h]).length>0)continue;var p=e.trim(e("*|owner > *|href",r[h]).text());c=new Object,e("*|current-user-privilege-set *|privilege *",r[h]).map(function(t){c[String(e(this)[0].localName).toLowerCase()]=!0}),c.all&&!c.read&&(c.read=!0),c.all&&!c.write&&(c.write=!0);var v=e("*|supported-report-set *|report > *",r[h]),m={};for(var g=0;g<v.length;g++)m[v[g].localName]=v[g].localName;e.fn.caldav.collectionData[a+h]={xml:e(r[h]).clone(!0),displayName:e("*|displayname",r[h]).text(),href:d,supportedReports:m,url:e("> *|href",r[h]).text().match(/^\//)?u.replace(/^(https?:\/\/[^\/]+).*$/,"$1")+e("> *|href",r[h]).text():e("> *|href",r[h]).text(),mailto:e("*|href:contains('mailto:')",r[h]).text().replace(/^mailto:/i,""),desc:e(r[h]).find("calendar-description").text(),ctag:e("*|getctag",r[h]).text(),principal:p,perms:c,xml:e(r[h]).clone(),color:e(r[h]).find("*|calendar-color").text().replace(/(#......)../,"$1"),order:e(r[h]).find("*|calendar-order").text()},e.fn.caldav.principalMap[p]!=undefined&&(e.fn.caldav.collectionData[a+h].principalName=e.fn.caldav.principals[e.fn.caldav.principalMap[p]].name),d!=""&&e.fn.caldav.principalMap[d]!=undefined&&(e.fn.caldav.principals[e.fn.caldav.principalMap[d]].cal=a+h)}a=0,e.fn.caldav.calendarData&&e.fn.caldav.calendarData.length>0&&(a=e.fn.caldav.calendarData.length);for(var h=0;h<i.length;h++){var p=decodeURIComponent(e.trim(e("*|owner > *|href",i[h]).text())),d=decodeURIComponent(e("> *|href",i[h]).text()),y=!1,b=!1;e("*|resourcetype > *|webdav-binding",i[h]).length>0&&(p=d.replace(/\/[^\/]*\/?$/,"/"),y=e(i[h]).find("*|resource-id *|href:first").text(),b=e(i[h]).find("*|parentset").clone()),c=new Object,e("*|current-user-privilege-set *|privilege *",i[h]).map(function(t){c[String(e(this)[0][e.fn.caldav.xmlNSfield]).toLowerCase()]=!0}),c.all&&!c.read&&(c.read=!0),c.all&&!c.write&&(c.write=!0),e.fn.caldav.calendarData[a+h]={displayName:e("*|displayname",i[h]).text(),href:d,url:e("> *|href",i[h]).text().match(/^\//)?e("> *|href",i[h]).text():u.replace(/^(https?:\/\/[^\/]+).*$/,"$1")+e("> *|href",i[h]).text(),mailto:e("*|href:contains('mailto:')",i[h]).text().replace(/^mailto:/i,""),desc:e(i[h]).find("*|calendar-description").text(),ctag:e("*|getctag",i[h]).text(),principal:p,bound:y,owner:e("*|owner *|href",i[h]).text(),parents:b,perms:c,xml:e(i[h]).clone(!0),color:e(i[h]).find("*|calendar-color").text().replace(/(#......)../,"$1"),order:e(i[h]).find("*|calendar-order").text()},e.fn.caldav.principalMap[p]!=undefined&&(e.fn.caldav.calendarData[a+h].principalName=e.fn.caldav.principals[e.fn.caldav.principalMap[p]].name)}return e.fn.caldav.calendarXml==undefined?e.fn.caldav.calendarXml=e(t.responseXML.documentElement).clone():e(e.fn.caldav.calendarXml).append(e("response",t.responseXML).clone()),this},findMyPrincipal:function(t){e.fn.caldav("spinner",!0);var n={Depth:0};e.fn.caldav.supports.bind&&(n.DAV="bind"),e.propfind(e.extend(!0,{},e.fn.caldav.options,{headers:n,data:'<?xml version="1.0" encoding="utf-8" ?>\n<propfind xmlns="DAV:"><prop><principal-collection-set/><current-user-principal/><calendar-description xmlns="urn:ietf:params:xml:ns:caldav" /></prop></propfind>',complete:function(n,r){e.fn.caldav("spinner",!1);if(r=="success"){e.fn.caldav.serverSupports=n.getResponseHeader("Dav");var i=String(e.fn.caldav.serverSupports).split(",");for(var s in i)e.fn.caldav.supports[e.trim(i[s])]=!0;e.fn.caldav.requestcount=0,n.responseXML.firstChild.baseName&&(e.fn.caldav.xmlNSfield="baseName"),jQuery.fn.caldav.data==undefined&&(jQuery.fn.caldav.data={}),e("*|principal-collection-set > *|href",n.responseXML).length>0?e.fn.caldav.data.principalCollection=decodeURIComponent(e.trim(e("*|principal-collection-set > *|href",n.responseXML).text())):e.fn.caldav.data.principalCollection=decodeURIComponent(e.trim(e("*|response > *|href:first",n.responseXML).text())),e.fn.caldav.data.myPrincipal=decodeURIComponent(e.trim(e("*|current-user-principal > *|href:first",n.responseXML).text()));if(!e.fn.caldav.options.fullDiscovery&&e.fn.caldav.data.myPrincipal.match(/\//)){e.fn.caldav.requestcount++,e.fn.caldav("getPrincipalData",e.fn.caldav.data.myPrincipal,t);return}e.fn.caldav("spinner",!0);if(e.fn.caldav.options.fullDiscovery)var o=1;else var o=0;e.propfind(e.extend(!0,{},e.fn.caldav.options,{url:e.fn.caldav.data.principalCollection,headers:{Depth:o},data:'<?xml version="1.0" encoding="utf-8" ?>\n<propfind xmlns="DAV:"><prop><current-user-principal/><displayname/><calendar-description xmlns="urn:ietf:params:xml:ns:caldav" /></prop></propfind>',complete:function(n,r){e.fn.caldav("spinner",!1);var i=e("*|response",n.responseXML);e.fn.caldav.data.myPrincipal=decodeURIComponent(String(e.trim(e("*|current-user-principal > *|href:first",n.responseXML).text()))).replace(/\/$/,""),e("*|href:first:contains("+e.fn.caldav.data.myPrincipal+")",n.responseXML).length==0&&(e.fn.caldav.requestcount++,e.fn.caldav("getPrincipalData",e.fn.caldav.data.myPrincipal,t));if(e.fn.caldav.options.fullDiscovery)return;for(var s=0;s<i.length;s++){var o=decodeURIComponent(e("*|href:first",i[s]).text());if(e.fn.caldav.principalMap[o]!=undefined)continue;debug&&console.log(" adding principal "+o+" named "+e.trim(e("displayname",i[s]).text())),e.fn.caldav.principals.push({href:o,name:e.trim(e("*|displayname",i[s]).text()),desc:e.trim(e("*|calendar-description",i[s]).text())});var u=e.fn.caldav.principals.length-1;e.fn.caldav.principalMap[o]=u,e.fn.caldav.requestcount++,e.fn.caldav("getPrincipalData",o,t)}}}))}else n.status==0?console.log("login failed, bad username and password or not served from the same host and port as your caldav server"):alert(n.status+" login failed, bad username and password or not served from the same host and port as your caldav server")}}))},getPrincipalData:function(t,n){e.fn.caldav("spinner",!0);var r={Depth:1};e.fn.caldav.supports.bind&&(r.DAV="bind"),e.propfind(e.extend(!0,{},e.fn.caldav.options,{url:t,headers:r,data:'<?xml version="1.0" encoding="utf-8" ?>\n<D:propfind xmlns:D="DAV:" xmlns:C="urn:ietf:params:xml:ns:caldav" xmlns:C2="http://calendarserver.org/ns/"><D:prop><D:displayname/><C:calendar-home-set/><C:calendar-user-address-set/><C:calendar-description/><C2:calendar-proxy-write/><C2:calendar-proxy-read/><C2:calendar-proxy-write-for/><C2:calendar-proxy-read-for/><D:resourcetype/></D:prop></D:propfind>',complete:function(t,r){e.fn.caldav("spinner",!1);try{var i=e("*|calendar-user-address-set > *|href:contains("+e.fn.caldav.data.myPrincipal+")",t.responseXML).filter(function(t){return e(this).text()==e.fn.caldav.data.myPrincipal?!0:!1});if(e(i).length>0){var s=e(i).parent().parent();jQuery.fn.caldav.data.principalDisplayName=e.trim(e("*|displayname",s).text()),jQuery.fn.caldav.data.principalHome=e.trim(e("*|calendar-home-set:first",s).text())}var o=e("*|response",t.responseXML);for(var u=0;u<o.length;u++){var a=decodeURIComponent(e("> *|href:first",o[u]).text());debug&&console.log("getPrincipalData found principal "+a,o[u]),e.fn.caldav.principalMap[a]==undefined&&(e.fn.caldav.principalMap[a]=e.fn.caldav.principals.length);var f=decodeURIComponent(e.trim(e("*|calendar-home-set:first",o[u]).text()));if(e("*|webdav-binding:first",o[u]).length>0)var f=a.replace(/\/[^\/]*\/?$/,"/");e.fn.caldav.principalMap[f]==undefined&&(e.fn.caldav.principalMap[f]=e.fn.caldav.principals.length),e.fn.caldav.principals[e.fn.caldav.principalMap[a]]={href:a,calendar:f,name:e.trim(e("*|displayname",o[u]).text()),calendarHome:e.trim(e("*|calendar-home-set:first",o[u]).text()),desc:e.trim(e("*|calendar-description",o[u]).text()),email:e.trim(e("*|href:contains('mailto:')",o[u]).text()).replace(/^mailto:/i,"")};var l=e("*|calendar-user-address-set > *|href",o);for(var c=0;c<l.length;c++)e.fn.caldav.principalMap[decodeURIComponent(e(l[c]).text())]==undefined&&String(e(l[c]).text()).length>1&&(e.fn.caldav.principalMap[decodeURIComponent(e(l[c]).text())]=e.fn.caldav.principalMap[a])}var h=e("*|calendar-proxy-write-for:first *|href",t.responseXML),p=e("*|calendar-proxy-read-for:first  *|href",t.responseXML),d=e(h,p);for(var u=0;u<d.length;u++){var v=decodeURIComponent(e(d[u]).text());e.fn.caldav.principalMap[v]==undefined&&(e.fn.caldav.requestcount++,e.fn.caldav("getPrincipalData",v,n))}}catch(m){}e.fn.caldav.requestcount--,e.fn.caldav.requestcount==0&&typeof n=="function"&&n(t,r)}}))},findDelagatedPrincipals:function(t,n){String(t).match(/\//)||(t=e.fn.caldav.data.myPrincipal),e.fn.caldav("spinner",!0),e.report(e.extend(!0,{},e.fn.caldav.options,{url:t,headers:{DAV:"bind"},data:'<?xml version="1.0" encoding="utf-8" ?>\n<expand-property xmlns="DAV:"> <property name="calendar-proxy-write-for" xmlns="http://calendarserver.org/ns/"><property name="displayname"/><property name="principal-URL"/><property name="calendar-user-address-set" xmlns="urn:ietf:params:xml:ns:caldav"/></property> <property name="calendar-proxy-read-for" xmlns="http://calendarserver.org/ns/"><property name="displayname"/><property name="principal-URL"/><property name="calendar-user-address-set" xmlns="urn:ietf:params:xml:ns:caldav"/></property></expand-property>',complete:function(t,r){e.fn.caldav("spinner",!1);if(r=="success"){var i=e("*|response",t.responseXML);for(var s=0;s<i.length;s++){var o=decodeURIComponent(e.trim(e(i[s]).children("*|href:first").text()));if(e.fn.caldav.principalMap[o]!=undefined)continue;e.fn.caldav.principals.push({href:o,calendar:decodeURIComponent(e.trim(e("["+e.fn.caldav.xmlNSfield+"=calendar-home-set]:first",t.responseXML).text())),name:e.trim(e("["+e.fn.caldav.xmlNSfield+"=displayname]",i[s]).text()),email:e.trim(e("*|href:contains('mailto:')",i[s]).text()).replace(/^mailto:/i,"")}),e.fn.caldav.principalMap[o]=e.fn.caldav.principals.length-1}typeof n=="function"&&n(t,r)}},error:function(t,n){e.fn.caldav("spinner",!1)}}))},calendars:function(){return e.fn.caldav.calendarData},principals:function(){return e.fn.caldav.principals},searchPrincipals:function(t,n,r,i){return e.fn.caldav("spinner",!0),e.report(e.extend(!0,{},e.fn.caldav.options,t,{url:e.fn.caldav.data.principalCollection,data:'<?xml version="1.0" encoding="utf-8"?>\n<x1:principal-property-search xmlns:x0="urn:ietf:params:xml:ns:caldav" xmlns:x1="DAV:"><x1:property-search><x1:prop><x1:'+n+"/>"+"</x1:prop>"+"<x1:match>"+r+"</x1:match>"+"</x1:property-search>"+"<x1:prop>"+"<x1:displayname/>"+"<x0:calendar-user-address-set/>"+"</x1:prop>"+"</x1:principal-property-search>",complete:function(t,n){e.fn.caldav("spinner",!1),n=="success"&&e(this).caldav("gotPrincipals",t,i)},error:function(t,n){e.fn.caldav("spinner",!1)}})),this},gotPrincipals:function(t,n){var r=e("multistatus",t.responseXML).clone(!0);return r.length>0&&typeof n=="function"&&n(r),this},getProperties:function(t,n,r){e.fn.caldav("spinner",!0);var i={"DAV:":"x0"},s=1,o="",u='xmlns:x0="DAV:" ';for(var a in n)i[n[a]]==undefined&&(i[n[a]]="x"+s,u=u+"xmlns:x"+s+'="'+n[a]+'" ',s++),o=o+"<"+i[n[a]]+":"+a+"/>";return t.headers==undefined&&(t.headers={Depth:0}),e.propfind(e.extend(!0,{},e.fn.caldav.options,t,{data:'<?xml version="1.0" encoding="utf-8"?>\n<x0:propfind '+u+">"+"  <x0:prop>"+o+"  </x0:prop>"+"</x0:propfind>",complete:function(t,n){e.fn.caldav("spinner",!1),n=="success"&&e(this).caldav("gotProperties",t,r)},error:function(t,n){e.fn.caldav("spinner",!1)}})),this},gotProperties:function(t,n){var r=e("multistatus",t.responseXML).clone(!0);return r.length>0&&typeof n=="function"&&n(r),this},bind:function(t,n,r){e.fn.caldav("spinner",!0),e.bind(e.extend(!0,{},e.fn.caldav.options,{url:n,data:'<?xml version="1.0" encoding="utf-8"?>\n<dav:bind xmlns:dav="DAV:">\n<dav:segment>'+t+"</dav:segment><dav:href>"+r+"</dav:href></dav:bind>"+"\n",complete:function(t,n){e.fn.caldav("spinner",!1)}}))},unbind:function(t,n){var r='<?xml version="1.0" encoding="utf-8" ?>\n<D:unbind xmlns:D="DAV:">\n<D:segment>'+t+"</D:segment>\n</D:unbind>",i=n;e.fn.caldav("spinner",!0),e.unbind(e.extend(!0,{},e.fn.caldav.options,{url:i,data:r,complete:function(t,n){e.fn.caldav("spinner",!1)}}))},getEvents:function(t,n,r,i){e.fn.caldav.coalesceEvents[i]==undefined?e.fn.caldav.coalesceEvents[i]={params:t,start:n,end:r}:(e.fn.caldav.coalesceEvents[i].start>n&&(e.fn.caldav.coalesceEvents[i].start=n),e.fn.caldav.coalesceEvents[i].end<r&&(e.fn.caldav.coalesceEvents[i].end=r));if(!e.fn.caldav.coalesceEvents[i].timeout){var s=function(t){e.fn.caldav("getCoalescedEvents",e.fn.caldav.coalesceEvents[t].params,e.fn.caldav.coalesceEvents[t].start,e.fn.caldav.coalesceEvents[t].end,t),delete e.fn.caldav.coalesceEvents[t]};e.fn.caldav.coalesceEvents[i].timeout=window.setTimeout(function(){s(i)},e.fn.caldav.eventAverageTime)}return this},getCoalescedEvents:function(t,n,r,i){var s=(new Date).getTime();return e.fn.caldav("spinner",!0),e.report(e.extend(!0,{},e.fn.caldav.options,t,{headers:{depth:1},data:'<?xml version="1.0" encoding="utf-8"?>\n<x0:calendar-query xmlns:x0="urn:ietf:params:xml:ns:caldav" xmlns:x1="DAV:">  <x1:prop>    <x0:calendar-data/>    <x1:resourcetype/>    <x1:getetag/>  </x1:prop>  <x0:filter>    <x0:comp-filter name="VCALENDAR">      <x0:comp-filter name="VEVENT">        <x0:time-range start="'+e.fn.caldav("formatDate",n)+'" end="'+e.fn.caldav("formatDate",r)+'"/>'+"      </x0:comp-filter>"+"    </x0:comp-filter>"+"  </x0:filter>"+"</x0:calendar-query>",complete:function(o,u){e.fn.caldav.eventTiming.push((new Date).getTime()-s);if(e.fn.caldav.eventTiming.length>e.fn.caldav.calendarData.length*2){var a=0;for(var f=0;f<e.fn.caldav.eventTiming.length;f++)a+=e.fn.caldav.eventTiming[f];e.fn.caldav.eventAverageTime=a/e.fn.caldav.eventTiming.length;var l=e.fn.caldav.eventTiming.shift()}i!=undefined&&(o.cal=0+i),e.fn.caldav("spinner",!1);if(u=="success")if(e("*|response *|prop *|calendar-data",o.responseXML).closest("*|propstat").find("*|status").text().match(/404/)){var c=[],h=e("*|href",o.responseXML);for(var f=0;f<h.length;f++)c.push(e(h[f]).text());e(this).caldav("multiget",t.url,i,c,n,r)}else e(this).caldav("parseEvents",o,n,r)},error:function(t,n){e.fn.caldav("spinner",!1)}})),this},parseEvents:function(t,n,r,i){var s=t.responseXML.getElementsByTagNameNS("urn:ietf:params:xml:ns:caldav","calendar-data"),o=new Array,u,a;for(var f=0;f<s.length;f++)u=e("*|href",e(s[f]).closest("*|response")).text(),a=e("*|getetag",e(s[f]).closest("*|response")).text(),u.length>0&&(e.fn.caldav.entries[u]=e(s[f]).text(),o[f]={href:u,text:e(s[f]).text(),etag:a});return o.length>0&&(typeof i=="function"?i(o,t.cal,n,r):e.fn.caldav.options.events(o,t.cal,n,r)),this},getAll:function(t,n,r,i){var s=(new Date).getTime();e.fn.caldav("spinner",!0);if(i==undefined)var o=i;else var o=e.fn.caldav.inboxMap[e.fn.caldav.data.myPrincipal];var u=[],a='<x0:comp-filter name="VEVENT"></x0:comp-filter>';if(r!=undefined){typeof r!="object"?u.push(r):u=r,a="";for(var f=0;f<u.length;f++)a=a+'<x0:comp-filter name="'+u[f]+'"></x0:comp-filter>'}return e.report(e.extend(!0,{},e.fn.caldav.options,t,{url:o,headers:{depth:1},data:'<?xml version="1.0" encoding="utf-8"?>\n<x0:calendar-query xmlns:x0="urn:ietf:params:xml:ns:caldav" xmlns:x1="DAV:">  <x1:prop>    <x0:calendar-data/>    <x1:resourcetype/>    <x1:getetag/>  </x1:prop>  <x0:filter>    <x0:comp-filter name="VCALENDAR">'+a+"    </x0:comp-filter>"+"  </x0:filter>"+"</x0:calendar-query>",complete:function(r,i){e.fn.caldav("spinner",!1);if(i=="success"){cal=undefined;if(e("*|response *|prop *|calendar-data",r.responseXML).closest("*|propstat").find("*|status").text().match(/404/)){var s=[],o=e("*|href",r.responseXML);for(var u=0;u<o.length;u++)s.push(e(o[u]).text());e(this).caldav("multiget",t.url,cal,s,undefined,undefined,n)}else e(this).caldav("parseEvents",r,undefined,undefined,n)}},error:function(t,n){e.fn.caldav("spinner",!1)}})),this},getInvites:function(t,n,r){var i=(new Date).getTime();return e.fn.caldav("spinner",!0),e.report(e.extend(!0,{},e.fn.caldav.options,t,{headers:{depth:1},data:'<?xml version="1.0" encoding="utf-8"?>\n<x0:calendar-query xmlns:x0="urn:ietf:params:xml:ns:caldav" xmlns:x1="DAV:">  <x1:prop>    <x0:calendar-data/>    <x1:resourcetype/>    <x1:getetag/>  </x1:prop>  <x0:filter>    <x0:comp-filter name="VCALENDAR">      <x0:comp-filter name="VEVENT">        <x0:prop-filter name="ATTENDEE">'+(r?'             <C:text-match collation="i;ascii-casemap">'+r+"</C:text-match>":"")+'          <x0:param-filter name="PARTSTAT">'+'             <x0:text-match collation="i;ascii-casemap">NEEDS-ACTION</x0:text-match>'+"          </x0:param-filter>"+"        </x0:prop-filter>"+"      </x0:comp-filter>"+"    </x0:comp-filter>"+"  </x0:filter>"+"</x0:calendar-query>",complete:function(r,s){e.fn.caldav.eventTiming.push((new Date).getTime()-i);if(e.fn.caldav.eventTiming.length>e.fn.caldav.calendarData.length*2){var o=0;for(var u=0;u<e.fn.caldav.eventTiming.length;u++)o+=e.fn.caldav.eventTiming[u];e.fn.caldav.eventAverageTime=o/e.fn.caldav.eventTiming.length;var a=e.fn.caldav.eventTiming.shift()}cal!=undefined&&(r.cal=0+cal),e.fn.caldav("spinner",!1);if(s=="success")if(e("*|response *|prop *|calendar-data",r.responseXML).closest("*|propstat").find("*|status").text().match(/404/)){var f=[],l=e("*|href",r.responseXML);for(var u=0;u<l.length;u++)f.push(e(l[u]).text());e(this).caldav("multiget",t.url,cal,f,start,end,n)}else e(this).caldav("parseEvents",r,start,end,n)},error:function(t,n){e.fn.caldav("spinner",!1)}})),this},syncCollection:function(t,n,r){if(!e.fn.caldav.calendarData[t]||!e.fn.caldav.reports["sync-collection"])return;var i={url:e.fn.caldav.calendarData[t].href,cal:t,start:n,end:r};if(!e.fn.caldav.calendarData[t].synctoken)var s='<?xml version="1.0" encoding="utf-8"?>\n<D:sync-collection xmlns:D="DAV:"><D:sync-token/><D:limit><D:nresults>1</D:nresults></D:limit><D:prop><D:getetag/></D:prop></D:sync-collection>';else var s='<?xml version="1.0" encoding="utf-8"?>\n<D:sync-collection xmlns:D="DAV:"><D:sync-token>'+e.fn.caldav.calendarData[t].synctoken+"</D:sync-token><D:prop><D:getetag/></D:prop></D:sync-collection>";e.report(e.extend(!0,{},e.fn.caldav.options,i,{headers:{depth:1},data:s,complete:function(i,s){e.fn.caldav("gotSyncData",i,s,t,n,r)}}))},gotSyncData:function(t,n,r,i,s){var o=t.url;if(e.fn.caldav.calendarData[r].synctoken&&e("*|href",t.responseXML).length>0){var u=[],a=e("*|href",t.responseXML);for(var f=0;f<a.length;f++)String(e(a[f]).siblings("*|status").text()).match(/404/)?typeof e.fn.caldav.options.eventDel=="function"&&e.fn.caldav.options.eventDel(e(a[f]).text()):u.push(e(a[f]).text());u.length>0&&e(this).caldav("multiget",o,r,u,i,s)}e.fn.caldav.calendarData[r].synctoken=e("sync-token",t.responseXML).text()},multiget:function(t,n,r,i,s){var o='<?xml version="1.0" encoding="utf-8"?>\n<x0:calendar-multiget xmlns:x0="urn:ietf:params:xml:ns:caldav" xmlns:x1="DAV:"><x1:prop><x0:calendar-data/><x1:getetag/></x1:prop>';for(var u=0;u<r.length;u++)o=o+"<x1:href>"+r[u]+"</x1:href>";o+="</x0:calendar-multiget>",e.report(e.extend(!0,{},e.fn.caldav.options,{url:e.fn.caldav.calendarData[n].href,headers:{depth:1},data:o,complete:function(t,r){e.fn.caldav("spinner",!1),n!=undefined&&(t.cal=0+n),r=="success"&&e(this).caldav("parseEvents",t,i,s)}}))},getToDos:function(t,n){return debug&&console.log(" requesting todos for calendar("+n+") href: "+t.url),e.fn.caldav("spinner",!0),e.report(e.extend(!0,{},e.fn.caldav.options,t,{headers:{depth:1},data:'<?xml version="1.0" encoding="utf-8"?>\n<x0:calendar-query xmlns:x0="urn:ietf:params:xml:ns:caldav" xmlns:x1="DAV:"><x1:prop><x0:calendar-data/><x1:resourcetype/></x1:prop><x0:filter><x0:comp-filter name="VCALENDAR"><x0:comp-filter name="VTODO"></x0:comp-filter></x0:comp-filter></x0:filter></x0:calendar-query>',complete:function(t,r){n!=undefined&&(t.cal=0+n),e.fn.caldav("spinner",!1),r=="success"&&e(this).caldav("parseTodos",t)}})),this},parseTodos:function(t){var n=e("*|response *|prop *|calendar-data",t.responseXML),r=new Array;for(var i=0;i<n.length;i++)href=e("*|href",e(n[i]).closest("*|response")).text(),href.length>0&&(e.fn.caldav.entries[href]=e(n[i]).text(),r[i]={href:href,text:e(n[i]).text()});return r.length>0&&e.fn.caldav.options.todos(r,t.cal),this},updateCollection:function(t,r,i){var s='xmlns:x1="http://apple.com/ns/ical/"',o=["DAV:","http://apple.com/ns/ical/"],u="";for(var a in i)i[a].ns!=undefined?(o.indexOf(i[a].ns)==-1?(n=o.length,s=s+" xmlns:x"+n+'="'+i[a].ns+'"',o.push(i[a].ns)):n=o.indexOf(i[a].ns),u=u+"<x"+n+":"+i[a].name+">"+i[a].value+"</x"+n+":"+i[a].name+">"):n=0;if(e.fn.caldav.calendarData[r]!=undefined)var f=e.fn.caldav.calendarData[r].href;else var f=r;return e.proppatch(e.extend(!0,{},e.fn.caldav.options,{url:f},t,{data:'<?xml version="1.0" encoding="utf-8"?>\n<x0:propertyupdate xmlns:x0="DAV:" '+s+">"+"<x0:set>"+"<x0:prop>"+u+"</x0:prop>"+"</x0:set>"+"</x0:propertyupdate>",complete:function(t,n){e.fn.caldav("spinner",!1),n=="success"&&e(this).caldav("updated",t)}})),this},setACL:function(t,r,i){var s='xmlns:x1="urn:ietf:params:xml:ns:caldav"',o=["DAV:","urn:ietf:params:xml:ns:caldav"],u="";for(var a in i)i[a].ns!=undefined?(o.indexOf(i[a].ns)==-1?(n=o.length,s=s+" xmlns:x"+n+'="'+i[a].ns+'"',o.push(i[a].ns)):n=o.indexOf(i[a].ns),u=u+"<x"+n+":"+i[a].name+">"+i[a].value+"</x"+n+":"+i[a].name+">"):n=0;if(e.fn.caldav.calendarData[r]!=undefined)var f=e.fn.caldav.calendarData[r].href;else var f=r;return e.proppatch(e.extend(!0,{},e.fn.caldav.options,{url:f},t,{data:'<?xml version="1.0" encoding="utf-8"?>\n<x0:acl xmlns:x0="DAV:" '+s+">"+"<x0:ace>"+"<x0:prop>"+u+"</x0:prop>"+"</x0:ace>"+"</x0:acl>",complete:function(t,n){n=="success"&&e(this).caldav("updated",t)}})),this},lock:function(t,n,r){if(!/2/.test(e.fn.caldav.serverSupports))return!1;var i=n?n:600,s='<?xml version="1.0" encoding="utf-8"?>\n<D:lockinfo xmlns:D="DAV:"><D:lockscope><D:exclusive/></D:lockscope><D:locktype><D:write/></D:locktype><D:owner><D:href>'+e.fn.caldav.data.myPrincipal+"</D:href>"+"</D:owner>"+"</D:lockinfo>";return e.lock(e.extend(!0,{},e.fn.caldav.options,{url:t},{headers:{Depth:0,Timeout:"Second-"+i},contentType:'text/xml; charset="utf-8"',data:s,complete:function(n,i){if(i=="success")if(n.status==200||n.status==201){var s=Number(String(e("["+e.fn.caldav.xmlNSfield+"=timeout]",n.responseXML).text()).replace(/second-/i,"")),o=window.setTimeout(function(){delete e.fn.caldav.locks[t]},s*1e3);e.fn.caldav.locks[t]={token:n.getResponseHeader("Lock-Token"),timeout:s,taken:e.now(),unsetlock:o},r(!0,n,i)}else typeof r=="function"&&r(!1,n,i);else typeof r=="function"&&r(!1,n,i)}})),!0},unlock:function(t){if(!/2/.test(e.fn.caldav.serverSupports))return!1;if(!(e.fn.caldav.locks[t]&&e.fn.caldav.locks[t].timeout>(e.now()-e.fn.caldav.locks[t].taken)/1e3))return;var n=e.fn.caldav.locks[t].token;window.clearTimeout(e.fn.caldav.locks[t].unsetlock),e.unlock(e.extend(!0,{},e.fn.caldav.options,{url:t},{headers:{"Lock-Token":n},complete:function(e,t){if(t!="success")return e.abort(),!1}}))},makeCalendar:function(t,r,i){var s='xmlns:x2="http://apple.com/ns/ical/"',o=["urn:ietf:params:xml:ns:caldav","DAV:","http://apple.com/ns/ical/"],u="";for(var a in i)i[a].ns!=undefined?(o.indexOf(i[a].ns)==-1?(n=o.length,s=s+" xmlns:x"+n+'="'+i[a].ns+'"',o.push(i[a].ns)):n=o.indexOf(i[a].ns),u=u+"<x"+n+":"+i[a].name+">"+i[a].value+"</x"+n+":"+i[a].name+">"):n=0;return e.fn.caldav.supports["extended-mkcol"]?e.mkcol(e.extend(!0,{},e.fn.caldav.options,t,{data:'<?xml version="1.0" encoding="utf-8"?>\n<x1:mkcol xmlns:x0="urn:ietf:params:xml:ns:caldav" xmlns:x1="DAV:" '+s+">"+" <x1:set>\n"+"   <x1:prop>\n"+"     <x1:resourcetype>\n"+"       <x1:collection/>\n"+"       <x0:calendar/>\n"+"     </x1:resourcetype>\n"+u+'      <x0:supported-calendar-component-set><x0:comp name="VEVENT"/><x0:comp name="VTODO"/><x0:comp name="VJOURNAL"/></x0:supported-calendar-component-set>'+"    </x1:prop>\n"+"  </x1:set>\n"+"</x1:mkcol>",complete:function(t,n){e.fn.caldav("spinner",!1),n=="success"&&e(this).caldav("madeCalendar",t)}})):e.mkcalendar(e.extend(!0,{},e.fn.caldav.options,t,{data:'<?xml version="1.0" encoding="utf-8"?>\n<x0:mkcalendar xmlns:x0="urn:ietf:params:xml:ns:caldav" xmlns:x1="DAV:" '+s+">"+"  <x1:set>"+"    <x1:prop>"+u+'      <x0:supported-calendar-component-set><x0:comp name="VEVENT"/><x0:comp name="VTODO"/><x0:comp name="VJOURNAL"/></x0:supported-calendar-component-set>'+"    </x1:prop>"+"  </x1:set>"+"</x0:mkcalendar>",complete:function(t,n){e.fn.caldav("spinner",!1),n=="success"&&e(this).caldav("madeCalendar",t)}})),this},delCalendar:function(t){e.fn.caldav("spinner",!0),t.length>3?url=t:url=e.fn.caldav.calendarData[t].href;var n=e.extend(!0,{},jQuery.fn.caldav.options);return n.url=url,delete n.headers,e.options(e.extend(!0,n,{contentType:undefined,headers:{},data:null,complete:function(r,i){if(i!="success"&&i!="notmodified"){e.fn.caldav("spinner",!1),e.fn.caldav.options.deletedCalendar.apply!=undefined&&e.fn.caldav.options.deletedCalendar(r,i);return}e.del(e.extend(!0,n,{data:null,headers:{Depth:"infinity"},complete:function(n,r){e.fn.caldav("spinner",!1),e.fn.caldav.options.deletedCalendar!=undefined&&e.fn.caldav.options.deletedCalendar.apply!=undefined&&e.fn.caldav.options.deletedCalendar(t,n,r)}}))}})),this},putEvent:function(t,n){e.fn.caldav("spinner",!0);var r=e.extend(!0,{},jQuery.fn.caldav.options,t);return e.fn.caldav.locks[t.url]?(r.headers==undefined&&(r.headers={}),r.headers.If=e.fn.caldav.locks[t.url].token,r["Schedule-Reply"]!=undefined&&(r.headers["Schedule-Reply"]=r["Schedule-Reply"]),e.put(e.extend(!0,r,{contentType:"text/calendar",data:n,complete:function(n,r){e.fn.caldav("spinner",!1),e.fn.caldav("unlock",t.url),e.fn.caldav.options.eventPut(n,r)}}))):e.head(e.extend(!0,r,{contentType:undefined,headers:{},data:null,complete:function(t,i){t.status!=404&&(r.headers["If-Match"]=t.getResponseHeader("ETag")),e.put(e.extend(!0,r,{contentType:"text/calendar",data:n,complete:function(t,n){e.fn.caldav("spinner",!1),e.fn.caldav.options.eventPut(t,n)}}))}})),this},putNewEvent:function(t,n){e.fn.caldav("spinner",!0);var r=e.extend(!0,{url:t.url},jQuery.fn.caldav.options);return delete r.headers,r.url=t.url,e.head(e.extend(!0,r,{contentType:undefined,headers:{},data:null,complete:function(r,i){return r.status!=404&&(t.url=t.url.replace(/(\..{1,8})?$/,"-1$1")),e.put(e.extend(!0,{},jQuery.fn.caldav.options,t,{contentType:"text/calendar",data:n,complete:function(t,n){e.fn.caldav("spinner",!1),e.fn.caldav.options.eventPut(t,n)}})),!1}})),this},delEvent:function(t){e.fn.caldav("spinner",!0);var n=e.extend(!0,{},jQuery.fn.caldav.options,t);if(e.fn.caldav.locks[t.url]){n.headers==undefined&&(n.headers={}),n.headers.If=e.fn.caldav.locks[t.url].token;var r={};n["Schedule-Reply"]!=undefined&&(n.headers["Schedule-Reply"]=n["Schedule-Reply"]),e.del(e.extend(!0,n,{data:null,complete:function(n,r){e.fn.caldav("spinner",!1),delete e.fn.caldav.locks[t.url],e.fn.caldav.options.eventDel(t.url)}}))}else delete n.headers,e.head(e.extend(!0,n,{contentType:undefined,headers:{},data:null,complete:function(r,i){if(r.status!=200&&r.status!=207)return r.abort(),e.fn.caldav("spinner",!1),!1;var s={};n["Schedule-Reply"]!=undefined&&(n.headers["Schedule-Reply"]=n["Schedule-Reply"]),n.headers={"If-Match":r.getResponseHeader("ETag")},e.del(e.extend(!0,n,{data:null,complete:function(n,r){e.fn.caldav("spinner",!1),e.fn.caldav.options.eventDel(t.url)}}))}}));return this},moveEvent:function(t){return e.fn.caldav("spinner",!0),e.fn.caldav.locks[t.url]&&(t.headers.If=e.fn.caldav.locks[t.url].token),e.move(e.extend(!0,{},jQuery.fn.caldav.options,t,{complete:function(n,r){e.fn.caldav("spinner",!1),e.fn.caldav.locks[t.url]&&delete e.fn.caldav.locks[t.url],e.fn.caldav.options.eventPut(n,r)}})),this},madeCalendar:function(e){return console.log("made calendar"+e),this},logout:function(){e.fn.caldav("spinner",!0);for(var t in e.fn.caldav.locks)e.fn.caldav("unlock",t);e.fn.caldav.options.username="logout",e.fn.caldav.options.password="logout";var n=e.options({url:e.fn.caldav.options.url+"logout",username:e.fn.caldav.options.username,password:e.fn.caldav.options.password,complete:function(t,n){return e.fn.caldav("spinner",!1),e.fn.caldav.options.url=undefined,e.fn.caldav.principals=undefined,e.fn.caldav.calendarData=undefined,e.fn.caldav.calendarXml=e("response",t.responseXML),e.fn.caldav.options.logout!=undefined&&e.fn.caldav.options.logout.apply!=undefined&&e.fn.caldav.options.logout(t,n),!1},error:function(t,n){return e.fn.caldav("spinner",!1),e.fn.caldav.options.url=undefined,e.fn.caldav.principals=undefined,e.fn.caldav.calendarData=undefined,e.fn.caldav.calendarXml=undefined,e.fn.caldav.options.logout!=undefined&&e.fn.caldav.options.logout.apply!=undefined&&e.fn.caldav.options.logout(t,n),!1}});return n.abort(),e.fn.caldav("spinner",!1),e.fn.caldav.options.url=undefined,e.fn.caldav.principals=undefined,e.fn.caldav.calendarData=undefined,e.fn.caldav.calendarXml=undefined,this},updated:function(e){return this},spinner:function(t){t?e(e.fn.caldav.options.loading).show().data("loading",e(e.fn.caldav.options.loading).data("loading")+1):(e(e.fn.caldav.options.loading).data("loading",e(e.fn.caldav.options.loading).data("loading")-1),e(e.fn.caldav.options.loading).data("loading")+0<1&&e(e.fn.caldav.options.loading).hide())},formatDate:function(e){function t(e){return e<10?"0"+e:e}var n=new Date(e);return n.getUTCFullYear()+""+t(n.getUTCMonth()+1)+""+t(n.getUTCDate())+"T"+t(n.getUTCHours())+""+t(n.getUTCMinutes())+""+t(n.getUTCSeconds())+"Z"}};e.fn.caldav=function(n){if(t[n])return t[n].apply(this,Array.prototype.slice.call(arguments,1));if(typeof n=="object"||!n)return t.init.apply(this,arguments);e.error("Method "+n+" does not exist on jQuery.caldav")}}(jQuery)